{% extends "base.html" %}

{% block title %}C Loop Analyzer - MyTools{% endblock %}

{% block extra_css %}
<style>
    #codeInput {
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 11px;
        line-height: 1.5;
        background-color: #1e1e1e;
        color: #d4d4d4;
        border: 1px solid #3c3c3c;
    }
    
    #codeInput::placeholder {
        color: #6a6a6a;
    }
    
    .analysis-result {
        background: white;
        border-radius: 8px;
        padding: 0;
    }
    
    .function-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 12px 15px;
        border-radius: 8px 8px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .function-name {
        font-family: 'Consolas', 'Monaco', monospace;
        font-size: 0.95rem;
        font-weight: 600;
    }
    
    .loop-count-badge {
        background: rgba(255, 255, 255, 0.25);
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .loop-count-badge i {
        font-size: 0.9rem;
    }
    
    .loop-container {
        padding: 12px 15px;
        background: #f8f9fa;
    }
    
    .nested-loop-item {
        margin: 8px 0;
        padding: 8px;
        border-left: 3px solid #667eea;
        background: white;
        border-radius: 4px;
    }
    
    .loop-header-inline {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
    }
    
    .loop-condition-inline {
        font-family: 'Consolas', 'Monaco', monospace;
        background: #f8f9fa;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        color: #495057;
    }
    
    .direct-calls {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    
    .loop-type {
        display: inline-block;
        padding: 3px 10px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-right: 8px;
    }
    
    .loop-for {
        background: #e3f2fd;
        color: #1976d2;
    }
    
    .loop-while {
        background: #f3e5f5;
        color: #7b1fa2;
    }
    
    .loop-do {
        background: #fff3e0;
        color: #f57c00;
    }
    
    .loop-condition {
        font-family: 'Consolas', 'Monaco', monospace;
        background: #f8f9fa;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 0.8rem;
        margin: 8px 0;
        border-left: 3px solid #667eea;
    }
    
    .called-functions {
        margin-top: 8px;
    }
    
    .called-function-item {
        display: flex;
        align-items: center;
        gap: 6px;
        background: #e8f5e9;
        color: #2e7d32;
        padding: 4px 10px;
        border-radius: 6px;
        margin: 2px 0;
        font-family: 'Consolas', 'Monaco', monospace;
        font-size: 0.8rem;
        border: 1px solid #4caf50;
        width: fit-content;
    }
    
    .called-function-item i {
        font-size: 0.75rem;
    }
    
    .no-results {
        text-align: center;
        padding: 60px 20px;
        color: #6c757d;
    }
    
    .no-results i {
        font-size: 4rem;
        opacity: 0.3;
        margin-bottom: 20px;
    }
    
    .stat-box {
        text-align: center;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
    }
    
    .stat-box h3 {
        margin: 0;
        font-size: 2rem;
        font-weight: bold;
    }
    
    .stat-box small {
        opacity: 0.9;
    }
    
    .results-container {
        max-height: none;
        overflow-y: visible;
        padding: 10px;
    }
    
    .function-box {
        margin-bottom: 25px;
        border: 2px solid #667eea;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        background: white;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .function-box:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.25);
    }
    
    .function-box:last-child {
        margin-bottom: 0;
    }
    
    .card-body {
        max-height: 600px;
        overflow-y: auto;
    }
    
    /* Fullscreen styles */
    .fullscreen-container {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #f8f9fa;
        z-index: 9999;
        overflow-y: auto;
    }
    
    .fullscreen-container.active {
        display: block;
    }
    
    .fullscreen-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 10;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    
    .fullscreen-content {
        padding: 30px;
        max-width: 1400px;
        margin: 0 auto;
    }
    
    .fullscreen-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .fullscreen-btn:hover {
        opacity: 0.9;
    }
    
    /* Collapse functionality */
    .function-header {
        cursor: pointer;
        user-select: none;
    }
    
    .collapse-icon {
        transition: transform 0.3s ease;
        margin-right: 8px;
    }
    
    .collapse-icon.collapsed {
        transform: rotate(-90deg);
    }
    
    .loop-container {
        transition: max-height 0.3s ease, opacity 0.3s ease;
        overflow: hidden;
    }
    
    .loop-container.collapsed {
        max-height: 0 !important;
        opacity: 0;
        padding: 0 !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <a href="{{ url_for('index') }}" class="btn btn-outline-primary btn-sm mb-2">
                <i class="bi bi-arrow-left"></i> Back
            </a>
            <h2 class="mb-0"><i class="bi bi-arrow-repeat"></i> C Loop Analyzer</h2>
            <p class="text-muted">Identify functions with loops and analyze function calls within them</p>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="d-flex gap-2 flex-wrap">
                        <button class="btn btn-primary" id="analyzeBtn">
                            <i class="bi bi-search"></i> Analyze Loops
                        </button>
                        <button class="btn btn-outline-secondary" id="clearBtn">
                            <i class="bi bi-x-circle"></i> Clear
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-3">
        <!-- Input Column -->
        <div class="col-lg-5">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-pencil-square"></i> C Code Input</h5>
                </div>
                <div class="card-body p-0">
                    <textarea id="codeInput" class="form-control border-0 rounded-0" 
                              rows="25" 
                              placeholder="Paste your C code here...

Example:
void processArray(int arr[], int size) {
    for(int i = 0; i < size; i++) {
        validate(arr[i]);
        transform(arr[i]);
    }
}

void searchData() {
    while(hasNext()) {
        getData();
    }
}"></textarea>
                </div>
                <div class="card-footer bg-light">
                    <small class="text-muted">
                        <i class="bi bi-info-circle"></i> Analyzes for, while, and do-while loops
                    </small>
                </div>
            </div>
        </div>

        <!-- Output Column -->
        <div class="col-lg-7">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-list-check"></i> Loop Analysis Results</h5>
                    <div class="d-flex gap-2">
                        <button class="fullscreen-btn" id="exportBtn" disabled>
                            <i class="bi bi-download"></i> Export
                        </button>
                        <button class="fullscreen-btn" id="fullscreenBtn" disabled>
                            <i class="bi bi-arrows-fullscreen"></i> Fullscreen
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="results-container" id="resultsContainer">
                        <div class="no-results">
                            <i class="bi bi-arrow-repeat"></i>
                            <h5>No analysis performed yet</h5>
                            <p>Enter C code and click "Analyze Loops"</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics -->
    <div class="row g-3 mt-3">
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="stat-box">
                        <h3 id="functionsWithLoops">0</h3>
                        <small>Functions with Loops</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="stat-box" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <h3 id="totalLoops">0</h3>
                        <small>Total Loops Found</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="stat-box" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <h3 id="functionsInLoops">0</h3>
                        <small>Functions Called in Loops</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Fullscreen Container -->
<div class="fullscreen-container" id="fullscreenContainer">
    <div class="fullscreen-header">
        <div>
            <h3 class="mb-0"><i class="bi bi-arrows-fullscreen me-2"></i> Loop Analysis Results - Fullscreen</h3>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-light btn-sm" id="expandAllBtn">
                <i class="bi bi-arrows-expand"></i> Expand All
            </button>
            <button class="btn btn-light btn-sm" id="collapseAllBtn">
                <i class="bi bi-arrows-collapse"></i> Collapse All
            </button>
            <button class="btn btn-success btn-sm" id="exportBtnFullscreen">
                <i class="bi bi-download"></i> Export
            </button>
            <button class="btn btn-light btn-sm" id="exitFullscreenBtn">
                <i class="bi bi-x-lg"></i> Exit
            </button>
        </div>
    </div>
    <div class="fullscreen-content" id="fullscreenContent">
        <!-- Content will be cloned here -->
    </div>
</div>

<!-- Notification Toast -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="notificationToast" class="toast" role="alert">
        <div class="toast-header">
            <i class="bi bi-check-circle-fill text-success me-2"></i>
            <strong class="me-auto">Notification</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="toastMessage">
            Action completed successfully!
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/c_loop_analyzer.js') }}?v={{ range(1, 999999) | random }}"></script>
{% endblock %}

